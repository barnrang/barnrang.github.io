---
layout: post
title:  "Understand your GPU: เรามาเข้าใจการ์ดจอกันหน่อยไหม"
date:   2018-08-30
categories: computer
author: barnrang
series: gpu
chapter: 1
---

*บทความนี้เหมาะสำหรับผู้ที่มีประสบการณ์ในการใช้งานคอมพิวเตอร์พื้นฐาน*

*เหมาะยิ่งขึ้นหากคุณเล่นเกมแต่ไม่ได้ศึกษาเกี่ยวกับอุปกรณ์คอมพิวเตอร์*

![RTX-2080]({{"/assets/images/rtx-2080.jpg" | absolute_url}})

 <p style="text-align: center;"> ที่มา https://www.digitaltrends.com/computing/nvidia-rtx-2080-twice-as-powerful-as-gtx-1080 </p>

เกมเมอร์หลายๆคนชอบที่จะชื่นชมความสวยงามของกราฟิก เอฟเฟกต์เจ๋งๆที่อลังการอย่างไม่น่าเชื่อว่าคอมพิวเตอร์ที่น่ารักของพวกเราจะสามารถแสดงผลเหล่านี้ได้ โดยเฉพาะพวกเกมเมอร์จริงจังหรือไม่ก็ตามมักจะรู้จักชิ้นส่วนคอมพิวเตอร์ที่มีนามว่า "การ์ดจอ" หรือเรียกเท่ๆ ภาษาอังกฤษว่า "GPU (Graphics Processing Unit)"

<!--more-->

## 1.มันคือ?
```
"มีไอ้นี่แล้วเล่นเกมลื่นขึ้น" -- ใครไม่รู้กล่าวไว้
```
มันก็ถูกและคงไม่มีอะไรมาโต้แย้งได้ 555 แต่หากขยายให้ลึกขึ้นเราอาจถามว่า "เกมแบบไหนที่ลื่นขึ้น?"

เนื่องจากชื่อภาษาไทยมันไม่ค่อยจะบอกอะไรเราเท่าไหร่ เรามายึดชื่อตามภาษาอังกฤษกันซึ่งแน่นอนว่าต้องเป็นเกมที่มีกราฟิกดีๆ มันก็นำด้วยคำว่า "graphic" อยู่แล้วซึ่งไม่ควรจะเกินการคาดเดา (ถ้าอ่านอังกฤษออก)

ดังนั้นการ์ดจอนี่แหละเป็น **ตัวช่วยประมวลผลกราฟิก** ให้เร็วขึ้น แต่ที่ว่า *ตัวช่วย* เนี่ย พูดอีกนัยนึงคือไม่มีก็ได้หรือ?

## 2.ความสัมพันธ์กับ CPU

โอเคนะ หวังว่าหลายๆคนเคยเรียนกันมาตั้งแต่สมัยประถม "CPU" หรือตัวประมวลผล*ทั่วไป* ซึ่งจะเรียกว่าสมองของคอมพิวเตอร์ก็ไม่ผิด การทำงานขั้นพื้นฐานหลายๆอย่างก็ดำเนินได้อย่างราบรื่นด้วยพลังแห่ง CPU ตั้งแต่เปิดเครื่อง เล่นเน็ต ดูหนังและอีกหลายๆ อย่าง เพื่อความชัดเจน CPU จะทำงานและตอบสนองตามการกระทำของผู้ใช้เช่นโปรแกรมจะถูกปิดเมื่อเรากดปุ่ม 'x' ที่มุมบนขวา

#  - สำหรับเกมส์?

ในทำนองเดียวกัน เวลาเล่นเกม CPU ก็ต้องตอบสนองต่อการกระทำของผู้ใช้ เช่น หากกดคลิกซ้าย → โจมตี, หากโดนโจมตี → เลือดลด หรือแม้กระทั่งสิ่งที่เกี่ยวกับกราฟิกก็ย่อมได้ เช่น หากขยับเมาส์ไปด้านซ้าย **_ต้องโชว์ภาพแบบไหนขึ้นหน้าจอของผู้ใช้ (อย่างถูกต้อง)_**

# - งั้นทำไมต้องมี GPU?

โอเค สมมติผมเล่น DOTA2 ที่ความละเอียด 1080p (1920 x 1080) เรามาเปรียบเทียบงานที่ CPU ต้องทำดีกว่า

- หากโดนโจมตี → เลือดลด

อันนี้เป็นงานไม่เหนื่อย เพราะเราต้องเปลี่ยนค่าของตัวเลขเพียงตัวเดียวคือ "เลือด(HP)" หากเขียนเป็นโค้ดแบบง่ายๆก็
```
HP = HP - damage
```
แต่ก่อนที่เราจะรู้ว่า damage เป็นเท่าไหร่ อาจมีกลไกที่ซับซ้อน เช่น โดนตรงไหนของร่างกาย, เราแพ้ทางหรือชนะทาง, โอกาสได้ critical hit เป็นเท่าไหร่, damage เป็น buff (ติดพิษ)หรือไม่

เงื่อนไขเหล่านี้ต้องคำนึงให้ดี ซึ่งงานประเภทนี้ไม่เหนื่อยแต่ "ซับซ้อน"

- หากขยับเมาส์ไปด้านซ้าย → แสดงผล

ก่อนอื่นเลย ถ้าใครมีพื้นฐานเรื่องรูปภาพก็คงจะเดาสิ่งที่จะพูดได้ไม่ยาก
แต่หากใครไม่มี ลองตามสรุปสั้นๆ ต่อไปนี่ได้
1. 1 pixel มีเลข 3 ตัวคือ R, G, B (Red, Green, Blue) 
2. 1920 x 1080 มีทั้งสิ้น 2,073,600 pixels
3. ในการแสดงผลครั้งหนึ่ง ต้องใช้ตัวเลข 2,073,600 x 3 = 6,220,800 ตัว
อืม... เยอะโคตร เรียกได้ว่านี่คืองานที่เหนื่อย แต่อย่างไรก็ตาม เราสามารถคำนวณตรงได้แบบไม่มากเงื่อนไข (Linear Algebra สมัยมหาลัย) ซึ่งขอนิยามว่างานเหนื่อยแต่ "ง่าย"

### - ดั่งสายสัมพันธ์นายจ้าง <-> ลูกจ้าง

เรามาแต่งเรื่องสมมติกันดีกว่า นาย A เป็นนักเรียนดีเลิศ จบม.ปลาย ตั้งแต่ 12 ขวบและจบดอกเตอร์ตั้งแต่อายุที่ยังดื่มเหล้าไม่ได้

นาย B1 ไม่ได้รับการศึกษาขั้นพื้นฐาน ใช้ชีวิตได้ด้วยการ~~เอาหัวผู้ขวางทางเดินนาย~~ทำงานจ้างไปเรื่อย

นาย C มีไร่อ้อยอันใหญ่ ต้องการจ้างคนมาช่วยจัดการเพราะปัจจุบันไม่มีคนใช้งานและตัวเองกำลังจะเกษียณ

นาย C สามารถจ้างนาย A ได้ เพราะเขาทำได้เกือบทุกอย่าง ถ้าฝึกหน่อยจะไปทำไร่ก็ทำได้ดีกว่าคนอื่น แต่แน่นอนว่าค่าตัวเขาแพงเพราะว่านอกจากจะทำได้เกือบทุกอย่าง เขายังทำได้อย่างรวดเร็ว

หากจ้างนาย B1 เขาคงทำได้แค่งานไร่ เพราะไม่มีความรู้พอที่จะจัดการกับไร่อ้อยอันนี้ และแน่นอนว่าหากจ้างเขาแค่คนเดียว ไร่อ้อยแห่งนี้ก็ต้องพบกับจุดจบ (หวังว่าผู้อ่านพอจะจับทางได้ว่า CPU คือใคร)

ดังนั้น C ต้องจ้าง A ก่อนเป็นอันดับแรกซึ่งแค่นั่นก็เพียงพอที่จะทำให้ไร่อยู่ต่อไป แต่ผลผลิตคงจะต่ำติดดิน ถ้าจ้างคนแบบ A หลายๆ คน A2, A3, A4... ผลผลิตคงจะเพิ่มใช่ย่อย แต่ว่า C ไม่มีทางจ่ายค่าจ้างได้แน่นอน...

ในทางกลับกัน ถ้า C เลือกที่จะจ้าง B1 หลายๆคน B1, B2, B3, ... เอาสัก 1000 คน เราก็สามารถ**_ทำไร่ไปพร้อมๆกันหลายคนได้_** แม้ว่าผลผลิตต่อคนจะลดลง เพราะว่ามีหลายคนผลผลิตรวมจึงเพิ่มขึ้นอย่างแน่นอน

เนื่องจากมีคนทำไร่จำนวนมากซึ่งตัวเองอาจไม่ได้สร้างประโยชน์มากขนาดนั้น นาย A จึงทุ่มเวลาเต็มที่เพื่อการจัดการไร่อ้อยและ**_ออกคำสั่งลูกจ้าง_**ทั้งหลาย และ**_ส่งเมล็ดพันธ์ุให้ลูกจ้างทุกคน_**

เมื่อลูกจ้างทุกคนทำงานเสร็จ นาย A ก็จัดการ**_เก็บผลผลิตและทำการบรรจุภัณฑ์เพื่อส่งออกไปขาย_**

ถึงจุดนี้ผู้อ่านบางคนอาจคิดว่า **_"จะทำตัวเข้มเอียงอะไรกันนักกันหนา"_** ซึ่งหากรำคาญตาก็ขออภัย แต่ทุกคำที่ highlight ไปนั้นคือหลักการทำงานสำคัญของ CPU - GPU!

## 3.ความสัมพันธ์กับ CPU(2)
งั้นถึงเวลาเฉลยแล้วว่าใครเป็นอะไร
- A คือ CPU เพราะสามารถทำงานได้อย่างรวดเร็วและทำได้เกือบทุกอย่าง แต่ค่าตัวแพง
- B(B1,B2,B3...) คือ GPU สามารถทำได้แค่บางอย่างแต่มากันเยอะเลยทำได้ปริมาณมากและไม่แพงเท่า A
- C คือเงินในกระเป๋าตังที่จะเอาไปซื้อคอมใหม่ 5555

กลับเข้ามาสู่ประเด็น games มันทำงานอย่างไร? ลองตามลำดับนี้ดู

1. CPU ส่งข้อมูลพื้นฐานไปให้ GPU เช่น game state, HP, Player Action etc. ไป พร้อมกับส่งคำสั่งให้คำนวณการแสดงผลครั้งถัดไป - **_ออกคำสั่งลูกจ้าง_**ทั้งหลาย และ**_ส่งเมล็ดพันธ์ุให้ลูกจ้างทุกคน_**
2. GPU จะมี threads หรือลูกจ้างจำนวนมาก (บางทีเรียก worker) ซึ่งสามารถคำนวณพร้อมๆกันในทีเดียวได้ ซึ่งทำให้การคำนวณการแสดงผลในครั้งถัดไปทำได้อย่างรวดเร็ว - **_ทำไร่ไปพร้อมๆกันหลายคนได้_** หากเป็นโปรแกรมเมอร์นี่ก็ไม่ต่างจากสิ่งที่เรียกว่า "Parallel Programming"
3. พอ GPU คำนวณเสร็จ ก็ต้องส่งค่ากลับไปหา CPU เพื่อให้ CPU นำค่านั้นไปจัดการและแสดงผลขึ้นหน้าจอผู้ใช้ - **_เก็บผลผลิตและทำการบรรจุภัณฑ์เพื่อส่งออกไปขาย_**

ทีนี้ก็พอจะเข้าใจพื้นฐานการทำงานของ GPU หรือเปล่า นี่เป็นแค่พื้นฐานมากซึ่งไม่ได้ลงลึกอะไรเลย อย่างไรก็ดี รู้เพียงเท่านี้อาจไม่เป็นประโยชน์สำหรับบางคน ดังนั้นสำหรับ **PART 2 เราจะอธิบายถึงคุณสมบัติการ์ดจอและผลกระทบต่อประสิทธิภาพในการทำงาน** ซึ่งอาจมีประโยชน์ต่อการเลือกซื้อ GPU ใหม่สำหรับคอมที่คุณรัก