---
layout: post
title:  "อ่านง่าย: คอมสร้างรูป Generative Adversarial Networks (GANs)"
date:   2017-10-21
categories: CS231
author: barnrang
series: cs231
chapter: 4
---
สำหรับบทนี้ หวังว่าจะอ่านง่ายขึ้นละมั้งครับ 555

ช่วงนี้ก็คงจะเห็นประโยชน์ที่เหลือล้ำของไอ้เจ้า deep learning กันแล้วตั้งแต่แยกประเภทรูปภาพยันเป็นเทพซาอิ
(AlphaGo) ซึ่งงานเหล่านี้ล้วนเป็นงานที่มี "กระดาษคำตอบ" เตรียมไว้แล้ว (supervised learning) ซึ่งเจ้า
กระดาษคำตอบนั่นก็คือข้อมูลที่ระบุว่ารูปภาพแต่ละอันคืออะไรเช่น รูปที่ 1 คือไก่ รูปที่ 2 คือพระเจ้าเป็นต้น
![classification-ex]({{"/assets/images/god.jpg" | absolute_url}})
แต่ในที่นี้
ข้อมูลที่นำเข้าล้วนไม่มี "กระดาษคำตอบ" (unsupervised learning) หรือข้อมูลเข้ามาแบบเปลือยๆ เพื่อมาใช้ในการ
สร้างรูปภาพใหม่ๆ ที่สวยงาม
<!--more-->
แต่แล้วมันก็มีบุคคลผู้มีความคิดอยากได้รูป <a href="https://arxiv.org/abs/1708.05509" target="blank">"พระเจ้า"</a>(หรือเข้าไปเล่นได้<a href="http://make.girls.moe/#/" target="blank">ที่นี่</a>) มาครอบครอง
อีกหลายๆ รูป แน่นอนว่าสิ่งที่เราควรจะทำคือการป้อนรูปภาพระเจ้าเข้าไปหลายๆ รูป แต่แล้วไงต่อดีหล่ะ?

# Explaination!
ตอนนี้ มนุษย์ได้สร้างเครื่องจักรไว้แยกประเภพรูปภาพแล้ว
![classification]({{"/assets/images/gorilla.jpg" | absolute_url}})
ถ้าเราสร้างเครื่องจักรใหม่แต่เราจะให้มันแยกเป็น Yes/No แทน เราเรียกมันว่า Discriminator (แปลตรงๆคือแยก)

ในที่นี้เราแยกว่ารูปภาพดังต่อไปนี้เป็นภาพที่ดีต่อใจหรือไม่
![discriminator]({{"/assets/images/discriminator.jpg" | absolute_url}})
ซึ่งในทางปฏิบัติมันไม่ยากเลยที่จะสร้างเครื่องจักรใหม่ตัวนี้ (ในกรณีแยกประเภทมีตั้งแต่ หมู หมา แมว ฯลฯ
แต่สำหรับ discriminator มีแค่ Yes/No เท่านั้น)

ต่อไปเราก็จะสร้างเครื่องจักรอีกอันนึงเป็นตัวสร้างรูปภาพนามว่า Generator
![generator]({{"/assets/images/generator.jpg" | absolute_url}})
ตัว Generator ของเราก็จะพยายามเต็มที่เพื่อสร้างรูปที่ดีต่อใจคุณนายท่านให้ได้มากที่สุดโดยจะรับข้อมูลเข้าเป็น
ค่า random ใดๆ

# ดั่งครูกับนักเรียน
หากลองเปรียบ Generator เป็นนักเรียนที่ต้องส่งงานให้ Discriminator ที่เป็นอาจารย์ตรวจว่าผ่านหรือไม่ผ่าน
เราจะสามารถวาดแผนผังได้ดังนี้
![outline1]({{"/assets/images/graphGAN1.jpg" | absolute_url}})
แต่แน่นอนว่าการจะมาเป็นอาจารย์นั้นก็ต้องผ่านรูปภาพมาเป็นร้อยเป็นพัน ก็ต้องมีหน่วยที่คอยป้อนรูปภาพ "จริงๆ"
ให้อาจารย์ด้วย
![outline2]({{"/assets/images/GAN2.jpg" | absolute_url}})

เนื่องจากอาจารย์เป็นคนที่หยิ่งมาก หากรู้ว่าคนรูปภาพที่ได้รับมานั้น นักเรียน(Generator)เป็นคนวาด อาจารย์
ก็จะถือว่า "ไม่โมเอะ" ไปเลยโดยปริยาย หรือถ้าคิดอีกแบบคืออาจารย์จะคอยสงสัยว่ารูปภาพดังกล่าว "มาจากนักเรียนหรือไม่?"
![outline3]({{"/assets/images/GAN3.jpg" | absolute_url}})
ทีนี้สงครามที่แท้จริงระหว่างอาจารย์กับนักเรียนได้เริ่มขึ้น...

# War Strategy (แผนรบ)
สรุปได้ว่านี่เป็นสงครามระหว่าง อาจารย์(Discriminator) กับนักเรียน(Generator) ว่านักเรียนจะสามารถ
หลอกอาจารย์ได้หรือไม่ ซึ่งการหลอกสำหรับคือการที่อาจารย์หลงเชื่อว่านี่คือรูปภาพ "จริง"

เรากำหนดแต้มสำหรับการตัดสินในสงครามนี้ด้วย
  - $$T$$ คือความแม่นยำในการจำแนกของอาจารย์ (จากนักเรียน/ไม่นักเรียน)
  - $$S$$ คือแต้มที่ไว้บอกว่านักเรียนหลอกอาจารย์ได้มากแค่ไหน

แน่นอนว่าทั้งสองฝ่ายก็ต้องพยายามเพื่อทำให้แต้มของตนเองขึ้นไปได้มากที่สุด
ในตอนเริ่มแรกนั้น ทั้งสองฝ่ายก็อาจทำประสิทธิภาพได้ไม่ดีนัก (1:ภาพจริง,0:ภาพจากนักเรียน)
![outline4]({{"/assets/images/GAN4.jpg" | absolute_url}})
0.77 เป็นคะแนนที่อาจารย์ประเมินจากรูปจริง(ล่าง) พูดได้ว่า "รูปด้านล่างมีความเป็นรูปจริงอยู่ 0.77 (ประเมินโดยอาจารย์)"
ในขณะที่ 0.5 คือ "รูปจากนักเรียนมีความเป็นรูปจริงอยู่ 0.5 (ประเมินโดยอาจารย์)" ซึ่งคะแนนในอุดมคติที่อาจารย์ควรได้คือ
1.0 สำหรับรูปจริงและ 0.0 สำหรับรูปของนักเรียนในขณะเดียวกัน นักเรียนก็พยายามทำให้คะแนนที่อาจารย์ประเมินให้รูปของตนเป็น
1.0

หากลองคำนวนคะแนน $$T,S$$ แบบง่ายๆ

$$ T = \underbrace{0.77}_\text{จริง} + \underbrace{(1-0.5)}_\text{นักเรียน}=1.27 $$


$$ S = \underbrace{0.5}_\text{หลอก} $$

ซึ่งผลการประเมินอาจารย์ก็ไม่ถูกต้องนัก ทำให้การพัฒนาของนักเรียนก็ไม่ชัดเจนไปด้วย

ผ่านวันผ่านคืนอาจารย์ก็ดูคะแนนที่ตัวเองได้รับและพัฒนาตัวเองให้มีสายตาที่แหลมคมในขณะเดียวกันก็
อธิบายให้นักเรียนรู้ว่าภาพของเขามีจุดบกพร่องตรงไหน เมื่ออาจารย์จำแนกได้เก่งมากขึ้น นักเรียนก็ต้องได้รับ
คำแนะนำที่ดีเช่นกันทำให้ศึกระหว่างทั้งสองเข้มข้นขึ้น
![outline5]({{"/assets/images/GAN5.jpg" | absolute_url}})
คำนวนคะแนนด้วยวิธีเดิม

$$ T = \underbrace{0.9}_\text{จริง} + \underbrace{(1-0.4)}_\text{นักเรียน}=1.5 $$


$$ S = \underbrace{0.4}_\text{หลอก} $$

ซึ่งในที่นี้คะแนน $$S$$ ไม่ได้ดีขึ้น แต่นั่นเพราะอาจารย์เข้มงวดขึ้นนั่นเอง

แน่นอนว่าจากสำนวน "practice makes perfect" ถ้าฝึกกันเป็นคู่ก็ "dual practice makes invincible"(ไม่ค่อยเกี่ยวเท่าไหร่)
การพัฒนาของทั้งคู่นั้นจะไปอย่างเข้มข้น เพราะว่าทั้งคู่อยู่ในสภาพที่ต้องแข่งขันกันเพื่อเอาชนะอีกฝ่ายให้ได้

![outline6]({{"/assets/images/GAN6.jpg" | absolute_url}})

เมื่อสงครามได้จบลง ไม่ว่าใครจะแพ้หรือชนะทั้งคู่ก็ได้พัฒนาตนเองจนเป็นเทพแล้วไม่ใช่หรือ ซึ่งการต่อยกันระหว่าง
Generator กับ Discriminator นี่แหละที่มีนัยยะสำคัญกับคำว่า "Adversarial" หรือ "เป็นศัตรู" ในภาษาไทยและเป็นที่มาของเทคนิคที่นามว่า
~~~~
GANs = Generative Adversarial Networks
~~~~
สำหรับรายละเอียดลงลึกใดๆ หากมีเวลาจะพยายามเขียนเวอร์ชั่น "อ่านยาก" ให้ได้อ่านกันนะครับผม

Ref:
- <a href="http://make.girls.moe/#/" target="blank">MakeGirlsMoe</a>
- <a href="http://cs231n.stanford.edu/" target="blank">Stanford CS231</a>
